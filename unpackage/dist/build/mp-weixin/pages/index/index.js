"use strict";const e=require("../../common/vendor.js"),o=require("../../utils/api.js"),a=require("../../utils/auth.js");if(require("../../utils/request.js"),require("../../utils/env.js"),!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-tag")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-section")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+s+(()=>"../../uni_modules/uni-tag/components/uni-tag/uni-tag.js")+i+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+n+(()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+t)();const i=()=>"../components/adBell.js",n=()=>"../components/abEmpty.js",s=()=>"../components/abButton.js",t=()=>"../components/abRadio.js",l={__name:"index",setup(i){let n=a.getToken();e.index.$on("setAdd",(function(e){console.log(e);let o=t.value.findIndex((o=>o.desk==e.desk));t.value[o].undoneRecord=!0})),e.onLoad((()=>{n?o.authTokenApi({token:n}).then((e=>{console.log(e)})).catch((o=>{e.index.redirectTo({url:"/pages/login/login"})})):e.index.redirectTo({url:"/pages/login/login"})}));const s=e.reactive({startTime:"",endTime:""});e.dayjs().hour()<12?(s.startTime=e.dayjs().startOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss"),s.endTime=e.dayjs().endOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss")):(s.startTime=e.dayjs().startOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"),s.endTime=e.dayjs().endOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"));const t=e.ref([]);e.onPullDownRefresh((async()=>{let a=await o.orderApi(s);t.value=a,k.value="",e.index.stopPullDownRefresh()}));const l=e.reactive([{text:"设置已完成",style:{backgroundColor:"#dd524d",fontSize:"14px"}}]),u=e.reactive({actualMoney:"",id:"",isFinish:!0}),d=["正常辣","微辣","特辣"],r=["","warning","error"],c=e.ref(null),p=async()=>{await o.orderUpdateApi(u),e.index.showToast({title:"设置成功",icon:"success",mask:!0});let a=await o.orderApi(s);t.value=a,c.value.close()},m=e.ref(null),v=e.ref("1"),f=e.ref("1"),y=e.ref(""),h=e.ref(""),g=e.ref(null),w=()=>{m.value.open();let o=e.dayjs().format("HH:mm");y.value=o+"-"+(t.value.length+1)+"号订单"},x=async()=>{if(y.value)try{let a=await o.orderAddApi({orderName:y.value,isPack:"2"==v.value,taste:Number(f.value),isFinish:!1,totalMoney:0,actualMoney:0,desk:Number(h.value)||""});m.value.close(),a&&(e.index.showToast({title:"创建成功,请添加菜品",icon:"none",mask:!0}),setTimeout((()=>{e.index.navigateTo({url:"/pages/orderDetail/index?id="+a})}),1e3))}catch(a){m.value.close()}else g.value._Focus()};e.onShow((async()=>{let e=await o.orderApi(s);t.value=e}));const k=e.ref(""),j=async()=>{if(!k.value)return;let e=await o.orderApi({id:k.value});t.value=e},b=async()=>{e.index.showModal({title:"提示",content:"确定要设置所有订单已完成吗？",success:async({confirm:a,cancel:i})=>{a&&(await o.setFinishApi(),e.index.showToast({title:"设置成功",icon:"success"}))}})},M=()=>{e.index.scanCode({success:e=>{console.log(e),T(e.result)},fail:o=>{e.index.showModal({title:"失败",content:o.errMsg,showCancel:!0}),console.log(o)}})},T=o=>{let a="";if(o.includes("id=")){a=`?id=${o.match(/id=([^&]+)/)?o.match(/id=([^&]+)/)[1]:null}`}if(o.includes("desk=")){a=`?desk=${o.match(/desk=([^&]+)/)?o.match(/desk=([^&]+)/)[1]:null}`}a&&e.index.navigateTo({url:"/pages/orderDetail/index"+a})};return(o,a)=>e.e({a:e.o(j),b:e.o((e=>k.value=e)),c:e.p({clearable:!0,prefixIcon:"search",confirmType:"搜索",placeholder:"输入订单ID精准查询",modelValue:k.value}),d:e.o(M),e:e.p({icon:"scan"}),f:e.f(t.value,((o,a,i)=>e.e({a:e.t(o.orderName),b:e.t(o.showTime),c:o.taste&&1!=o.taste},o.taste&&1!=o.taste?{d:"2c583f1d-4-"+i+",2c583f1d-3-"+i,e:e.p({type:r[o.taste-1],text:d[o.taste-1],size:"small"})}:{},{f:o.isPack},o.isPack?{g:"2c583f1d-5-"+i+",2c583f1d-3-"+i,h:e.p({text:"打包",size:"small",type:"warning"})}:{},{i:o.desk},o.desk?{j:"2c583f1d-6-"+i+",2c583f1d-3-"+i,k:e.p({text:o.desk+"号桌",size:"small",type:"primary"})}:{},{l:"2c583f1d-7-"+i+",2c583f1d-3-"+i,m:e.p({text:o.isFinish?"已完成":"进行中",size:"small",type:o.isFinish?"":"primary"}),n:o.undoneRecord},(o.undoneRecord,{}),{o:!o.isRead&&!o.isRead&&!o.isFinish},o.isRead||o.isRead||o.isFinish?{}:{p:"2c583f1d-8-"+i+",2c583f1d-3-"+i},{q:e.o((a=>((o,a)=>{e.index.navigateTo({url:"/pages/orderDetail/index?id="+o.id+"&name="+a})})(o,(e=>e.orderName+(e.desk?"-"+e.desk+"号桌":""))(o))),o.id),r:o.id,s:e.o((e=>(async e=>{c.value.open(),u.id=e.id,u.isFinish=!0,u.actualMoney=e.actualMoney})(o)),o.id),t:"2c583f1d-3-"+i+",2c583f1d-2",v:e.p({"right-options":l,disabled:o.isFinish})}))),g:0===t.value.length},(t.value.length,{}),{h:e.o(w),i:e.p({icon:"plusempty"}),j:e.o(b),k:e.p({icon:"gear",type:"primary"}),l:e.o((e=>u.actualMoney=e)),m:e.p({errorMessage:!0,type:"number",focus:!0,placeholder:"请输入收款金额",modelValue:u.actualMoney}),n:e.p({title:"实收金额",type:"line",padding:!0}),o:e.o((e=>c.value.close())),p:e.o(p),q:e.p({duration:2e3,"before-close":!0}),r:e.sr(c,"2c583f1d-12",{k:"popup1"}),s:e.p({type:"dialog"}),t:e.sr(g,"2c583f1d-18,2c583f1d-17",{k:"nameInput"}),v:e.o((e=>y.value=e)),w:e.p({errorMessage:!0,type:"text",focus:!0,placeholder:"请输入订单名称",modelValue:y.value}),x:!y.value},(y.value,{}),{y:e.o((e=>v.value=e)),z:e.p({list:[{label:"在这吃",value:"1"},{label:"打包",value:"2"}],modelValue:v.value}),A:e.o((e=>f.value=e)),B:e.p({list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}],modelValue:f.value}),C:e.o((e=>h.value=e)),D:e.p({type:"number",placeholder:"请输入桌号(可不填)",modelValue:h.value}),E:e.o((e=>m.value.close())),F:e.o(x),G:e.p({title:"添加订单",duration:2e3,"before-close":!0}),H:e.sr(m,"2c583f1d-16",{k:"popup2"}),I:e.p({type:"dialog"})})}},u=e._export_sfc(l,[["__scopeId","data-v-2c583f1d"]]);wx.createPage(u);
