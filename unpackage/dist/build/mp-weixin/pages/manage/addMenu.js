"use strict";const e=require("../../common/vendor.js"),l=require("../../store/globalStore.js"),a=require("../../utils/api.js"),i=require("../../utils/env.js");if(require("../../utils/request.js"),require("../../utils/auth.js"),!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+n+u+(()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+s)();const u=()=>"../components/abRadio.js",n=()=>"../components/abPicker.js",s=()=>"../components/abButton.js",t={__name:"addMenu",setup(u){const n=e.ref({id:"",name:"",price:"",type:"1",picImg:"",isOnline:!0,unit:"串"});e.index.$on("menuItem",(function(l){e.index.setNavigationBarTitle({title:"修改菜单"}),n.value=l}));const s=e.ref([]),t=e.ref({tempFilePaths:[],tempFiles:[]}),o=e=>{console.log(e)},r=e=>{t.value=e},p=e.ref(null),m=async()=>{await p.value.validate(),t.value.tempFilePaths.length&&await(async()=>new Promise(((l,a)=>{e.index.uploadFile({url:`${i.env.baseUrl}/upload`,fileType:"image",filePath:t.value.tempFilePaths[0],name:"image",success:({data:e,statusCode:a})=>{console.log(e),n.value.picImg=JSON.parse(e).data,l(JSON.parse(e))},fail:e=>{console.log(e),a(e)}})})))(),console.log(n.value.picImg);let l="";n.value.picImg&&(l=n.value.picImg.includes("http")?"":n.value.picImg);let u={...n.value,type:Number(n.value.type),price:Number(n.value.price),picImg:l};n.value.id?await a.updateMenuApi(u):await a.addMenuApi(u),e.index.showToast({title:"成功",icon:"success",mask:!0}),e.index.navigateBack()},c={name:{rules:[{required:!0,errorMessage:"请填写商品名"}]},price:{rules:[{required:!0,errorMessage:"请填写价格"}]}};return(a,i)=>({a:e.o((e=>n.value.name=e)),b:e.p({type:"text",placeholder:"请输入商品名",modelValue:n.value.name}),c:e.p({label:"商品:",name:"name"}),d:e.o((e=>n.value.price=e)),e:e.p({type:"number",placeholder:"请输入价格",modelValue:n.value.price}),f:e.p({label:"价格:",name:"price"}),g:e.o((e=>n.value.type=e)),h:e.p({selectList:e.unref(l.selectList),modelValue:n.value.type}),i:e.p({label:"分类:",name:"unit"}),j:e.o((e=>n.value.unit=e)),k:e.p({list:[{label:"串",value:"串"},{label:"份",value:"份"},{label:"瓶",value:"瓶"},{label:"件",value:"件"},{label:"个",value:"个"}],modelValue:n.value.unit}),l:e.p({label:"单位:",name:"unit"}),m:n.value.isOnline,n:e.o((e=>n.value.isOnline=e.detail.value)),o:e.p({label:"上架:",name:"unit"}),p:e.o(r),q:e.o(o),r:e.o((e=>s.value=e)),s:e.p({fileMediatype:"image",mode:"grid",limit:"1",sizeType:"compressed",modelValue:s.value}),t:e.p({label:"预览图:",name:"unit"}),v:e.sr(p,"5a0b2900-0",{k:"menuForm"}),w:e.p({modelValue:n.value,rules:c}),x:e.o(m),y:e.p({icon:"plusempty"})})}};wx.createPage(t);
