"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/api.js");if(require("../../utils/request.js"),require("../../utils/auth.js"),require("../../utils/env.js"),!Array){(e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-tag")+e.resolveComponent("uni-card"))()}Math||((()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+n+(()=>"../../uni_modules/uni-tag/components/uni-tag/uni-tag.js")+t+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js")+i)();const t=()=>"../components/abMiniButton.js",i=()=>"../components/abEmpty.js",n=()=>"../components/adBell.js",s={__name:"order",setup(t){const i=e.ref([e.dayjs().subtract(1,"day").format("YYYY-MM-DD"),e.dayjs().format("YYYY-MM-DD")]),n=e.ref(e.dayjs().subtract(12,"month").format("YYYY-MM-DD")),s=e.ref(e.dayjs().format("YYYY-MM-DD")),o=e.ref(""),r=e.ref(""),l=e.ref([]),c=async()=>{await d({orderName:o.value,searchMoney:r.value})},u=e.computed((()=>({startTime:e.dayjs(i.value[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:e.dayjs(i.value[1]).endOf("day").format("YYYY-MM-DD HH:mm:ss")}))),d=async e=>{let t=await a.orderApi(e);l.value=t};e.watchEffect((async()=>{i.value[0]&&i.value[1]&&d(u.value)}));const p=e.computed((()=>l.value.reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)));e.onPullDownRefresh((async()=>{i.value=[e.dayjs().subtract(1,"day").format("YYYY-MM-DD"),e.dayjs().format("YYYY-MM-DD")];try{await d(u.value),e.index.stopPullDownRefresh()}catch(a){e.index.stopPullDownRefresh()}}));return(t,u)=>e.e({a:e.o((e=>i.value=e)),b:e.p({type:"daterange",start:n.value,end:s.value,rangeSeparator:"至",modelValue:i.value}),c:e.o(c),d:e.o((e=>r.value=e)),e:e.p({type:"number",prefixIcon:"search",placeholder:"请输入不低于的金额",modelValue:r.value}),f:e.o(c),g:e.o((e=>o.value=e)),h:e.p({type:"text",prefixIcon:"search",confirmType:"search",placeholder:"请输入订单关键字",modelValue:o.value}),i:e.t(l.value.length),j:e.t(e.unref(p)),k:e.t(l.value.filter((e=>!e.isFinish)).length),l:e.t(l.value.filter((e=>e.isFinish)).reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)),m:e.t(l.value.filter((e=>!e.isFinish)).reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)),n:e.f(l.value,((t,i,n)=>e.e({a:!t.isRead&&!t.isFinish},t.isRead||t.isFinish?{}:{b:"103c4f9a-4-"+n+",103c4f9a-3-"+n},{c:"103c4f9a-5-"+n+",103c4f9a-3-"+n,d:e.p({text:t.isFinish?"已完成":"未完成",size:"normal",type:t.isFinish?"success":"error"}),e:t.isPack},t.isPack?{f:"103c4f9a-6-"+n+",103c4f9a-3-"+n,g:e.p({text:"打包",size:"normal",type:"primary"})}:{},{h:t.desk},t.desk?{i:"103c4f9a-7-"+n+",103c4f9a-3-"+n,j:e.p({text:t.desk+"号桌",size:"normal"})}:{},{k:t.userOperation},t.userOperation?{l:"103c4f9a-8-"+n+",103c4f9a-3-"+n,m:e.p({type:"primary",text:"自助下单"})}:{},{n:t.actualMoney&&t.isFinish},t.actualMoney&&t.isFinish?{o:"103c4f9a-9-"+n+",103c4f9a-3-"+n,p:e.p({type:"primary",text:"实收:"+t.actualMoney})}:{},{q:e.o((a=>(a=>{e.index.setStorageSync("orderId",a.id),e.index.navigateTo({url:"/pages/orderDetail/orderInfo"})})(t)),t.id),r:"103c4f9a-10-"+n+",103c4f9a-3-"+n,s:!t.isFinish},t.isFinish?{}:{t:e.o((a=>(a=>{e.index.navigateTo({url:"/pages/orderDetail/index?id="+a.id+"&name="+a.orderName})})(t)),t.id),v:"103c4f9a-11-"+n+",103c4f9a-3-"+n,w:e.p({plain:!0})},{x:e.o((i=>(async t=>{e.index.showModal({title:"提示",content:"是否删除",success:({confirm:i,cancel:n})=>{i&&a.orderDeleteApi({id:t.id}).then((a=>{e.index.showToast({title:"删除成功"}),l.value=l.value.filter((e=>e.id!=t.id))}))}})})(t)),t.id),y:"103c4f9a-12-"+n+",103c4f9a-3-"+n,z:!t.isFinish},t.isFinish?{}:{A:e.o((i=>(async t=>{e.index.showModal({title:"实收金额",content:t.totalMoney,editable:!0,placeholderText:"请输入实收金额",showCancel:!0,success:({confirm:i,cancel:n,content:s})=>{i&&a.orderUpdateApi({id:t.id,actualMoney:s||0,isFinish:!0}).then((()=>{t.isFinish=!0,t.actualMoney=s||0,e.index.showToast({title:"成功",icon:"success",mask:!0})})).catch((()=>{e.index.showToast({title:"失败"})}))}})})(t)),t.id),B:"103c4f9a-13-"+n+",103c4f9a-3-"+n,C:e.p({plain:!0})},{D:t.id,E:"103c4f9a-3-"+n,F:e.p({title:t.orderName,"sub-title":t.showTime,extra:`金额：${t.totalMoney}`})}))),o:e.p({plain:!0}),p:e.p({plain:!0,type:"warn",icon:"trash",iconColor:"#fa2c19"}),q:0===l.value.length},0===l.value.length?{r:e.p({text:"暂无数据"})}:{})}};wx.createPage(s);
